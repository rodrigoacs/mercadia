<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>Mercadia</title>
    <link rel="icon" href="favicon.ico" />

    <meta name="theme-color" content="#18191e" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
      :root {
        --bg-body: #0f1014;
        --bg-panel: #18191e;
        --bg-input: #23242a;
        --border-color: #2a2b32;
        --accent-primary: #6366f1;
        --text-main: #e2e8f0;
        --text-muted: #94a3b8;
        --profit: #34d399;
        --loss: #f87171;
        --font-main: 'Inter', sans-serif;
      }

      body {
        background-color: var(--bg-body);
        color: var(--text-main);
        font-family: var(--font-main);
        padding-bottom: 60px;
        overflow-x: hidden;
      }

      .navbar {
        background-color: rgba(24, 25, 30, 0.85);
        backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--border-color);
        padding: 0.8rem 0;
        z-index: 1030;
      }
      .navbar-brand {
        font-weight: 800;
        letter-spacing: -0.5px;
        font-size: 1.2rem;
        background: linear-gradient(90deg, #fff, #a5b4fc);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .form-control-dark {
        background-color: var(--bg-input);
        border: 1px solid transparent;
        color: #fff;
        font-size: 0.9rem;
        border-radius: 8px;
        padding: 8px 12px 8px 38px;
      }
      .form-control-dark:focus {
        background-color: var(--bg-input);
        border-color: var(--accent-primary);
        box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.15);
        color: #fff;
      }

      .ui-panel {
        background-color: var(--bg-panel);
        border: 1px solid var(--border-color);
        border-radius: 12px;
        height: 100%;
        display: flex;
        flex-direction: column;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      }
      .panel-header {
        padding: 14px 18px;
        border-bottom: 1px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
      .panel-title {
        font-size: 0.7rem;
        font-weight: 700;
        text-transform: uppercase;
        color: var(--text-muted);
        letter-spacing: 0.8px;
      }
      .panel-body {
        padding: 18px;
        flex-grow: 1;
        position: relative;
      }
      .big-number {
        font-size: 1.5rem;
        font-weight: 700;
        color: #fff;
        line-height: 1.1;
      }
      .highlight-value {
        font-size: 1.8rem;
        background: linear-gradient(135deg, #e0e7ff 0%, #818cf8 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      @media (min-width: 768px) {
        .big-number {
          font-size: 2rem;
        }
        .highlight-value {
          font-size: 2.4rem;
        }
      }

      .table {
        --bs-table-bg: transparent;
        --bs-table-hover-bg: rgba(255, 255, 255, 0.03);
        margin-bottom: 0;
      }
      .table th {
        border-bottom: 1px solid var(--border-color);
        font-size: 0.7rem;
        text-transform: uppercase;
        color: var(--text-muted);
        padding: 12px 16px;
        white-space: nowrap;
      }
      .table td {
        border-bottom: 1px solid var(--border-color);
        padding: 12px 16px;
        font-size: 0.85rem;
        color: var(--text-main);
        vertical-align: middle;
      }
      .col-card-name {
        max-width: 40vw;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        font-weight: 600;
        color: #f1f5f9;
      }
      @media (min-width: 992px) {
        .col-card-name {
          max-width: 250px;
        }
      }

      .badge-tech {
        background: #23242a;
        border: 1px solid #333;
        color: #cbd5e1;
        font-size: 0.65rem;
        padding: 3px 8px;
        border-radius: 6px;
      }
      .badge-extra {
        background: rgba(99, 102, 241, 0.15);
        border: 1px solid rgba(99, 102, 241, 0.4);
        color: #a5b4fc;
        font-size: 0.6rem;
        font-weight: 600;
        padding: 3px 6px;
        border-radius: 4px;
      }
      .var-up {
        color: var(--profit);
        font-weight: 600;
      }
      .var-down {
        color: var(--loss);
        font-weight: 600;
      }

      .chart-container-main {
        position: relative;
        height: 240px;
        width: 100%;
      }
      .chart-container-sm {
        position: relative;
        height: 180px;
        width: 100%;
      }
      @media (min-width: 768px) {
        .chart-container-main {
          height: 320px;
        }
      }

      .search-wrapper {
        position: relative;
        width: 100%;
        max-width: 380px;
      }
      .search-icon {
        position: absolute;
        left: 12px;
        top: 50%;
        transform: translateY(-50%);
        color: var(--text-muted);
        width: 16px;
        height: 16px;
        pointer-events: none;
      }
      .btn-history {
        background: transparent;
        border: 1px solid var(--border-color);
        color: var(--text-muted);
        border-radius: 8px;
        padding: 4px 10px;
        transition: all 0.2s;
      }
      .btn-history:hover {
        background: #23242a;
        color: #fff;
        border-color: #6366f1;
      }
      .modal-content {
        background-color: var(--bg-panel);
        border: 1px solid var(--border-color);
        border-radius: 12px;
      }
      .btn-close {
        filter: invert(1) grayscale(100%) brightness(200%);
        opacity: 0.5;
      }
      .fade-in {
        animation: fadeIn 0.5s ease-out forwards;
        opacity: 0;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(5px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar sticky-top">
      <div class="container px-3">
        <div class="d-flex align-items-center w-100 justify-content-between">
          <div class="d-flex align-items-center flex-grow-1">
            <span class="navbar-brand d-none d-sm-block">MERCADIA</span>
            <span class="navbar-brand d-block d-sm-none">M</span>
            <div class="search-wrapper ms-2 me-auto">
              <svg
                class="search-icon"
                xmlns="http://www.w3.org/2000/svg"
                fill="none"
                viewBox="0 0 24 24"
                stroke="currentColor"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
                />
              </svg>
              <form onsubmit="performSearch(event)">
                <input
                  type="text"
                  id="searchInput"
                  class="form-control form-control-dark"
                  placeholder="Buscar..."
                  autocomplete="off"
                />
              </form>
            </div>
          </div>
          <div class="text-end ms-3 d-none d-sm-block">
            <div
              style="
                font-size: 0.6rem;
                letter-spacing: 0.5px;
                text-transform: uppercase;
                color: var(--text-muted);
                font-weight: 600;
              "
            >
              Atualizado
            </div>
            <div style="font-size: 0.85rem; font-weight: 500; color: #fff" id="lastUpdate">
              --/--
            </div>
          </div>
        </div>
      </div>
    </nav>

    <div class="modal fade" id="searchModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-xl modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title fs-6 text-uppercase text-muted fw-bold" id="searchModalTitle">
              Resultados
            </h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body p-0">
            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead>
                  <tr>
                    <th class="ps-4">Carta</th>
                    <th class="text-center d-none d-sm-table-cell">Set</th>
                    <th class="text-center">Hist√≥rico</th>
                    <th class="text-center">Qtd</th>
                    <th class="text-end pe-4">Total</th>
                  </tr>
                </thead>
                <tbody id="searchResultsBody"></tbody>
              </table>
            </div>
            <div id="noResults" class="text-center py-5 text-muted d-none">
              Nenhuma carta encontrada.
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="modal fade" id="historyDetailModal" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-sm modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header py-2">
            <div class="d-flex flex-column">
              <span
                class="text-uppercase"
                style="font-size: 0.65rem; color: var(--text-muted); font-weight: 700"
                >Hist√≥rico</span
              ><span class="fw-bold text-white" id="histTitle" style="font-size: 0.9rem">...</span>
            </div>
            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
          </div>
          <div class="modal-body p-0">
            <table class="table table-sm table-striped mb-0">
              <tbody id="historyTableBody"></tbody>
            </table>
          </div>
          <div class="modal-footer py-1 justify-content-center">
            <button
              class="btn btn-sm btn-outline-secondary w-100"
              data-bs-target="#searchModal"
              data-bs-toggle="modal"
            >
              Voltar
            </button>
          </div>
        </div>
      </div>
    </div>

    <div class="container mt-4 px-3 fade-in">
      <div class="row g-3 mb-4">
        <div class="col-12 col-lg-4">
          <div class="ui-panel">
            <div
              class="panel-body d-flex flex-row flex-lg-column justify-content-between justify-content-lg-center align-items-center align-items-lg-start h-100"
            >
              <span class="panel-title mb-lg-2">Patrim√¥nio Total</span>
              <div><span class="big-number highlight-value" id="kpiTotal">...</span></div>
            </div>
          </div>
        </div>

        <div class="col-12 col-lg-8">
          <div class="row g-3 h-100">
            <div class="col-6 col-md-3">
              <div class="ui-panel">
                <div class="panel-body">
                  <span class="panel-title">Volume</span>
                  <div class="big-number mt-2" id="kpiQty">...</div>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="ui-panel">
                <div class="panel-body">
                  <span class="panel-title">Ticket M√©dio</span>
                  <div class="big-number mt-2" id="kpiTicket">...</div>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="ui-panel">
                <div class="panel-body">
                  <span class="panel-title">Var. 24h</span>
                  <div class="big-number mt-2" id="kpiVar">...</div>
                </div>
              </div>
            </div>
            <div class="col-6 col-md-3">
              <div class="ui-panel">
                <div class="panel-body">
                  <span class="panel-title">Var. 30 Dias</span>
                  <div class="big-number mt-2" id="kpiMonth">...</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="row mb-4">
        <div class="col-12">
          <div class="ui-panel">
            <div class="panel-header"><span class="panel-title">Evolu√ß√£o Patrimonial</span></div>
            <div class="panel-body">
              <div class="chart-container-main"><canvas id="mainChart"></canvas></div>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-12 col-md-6">
          <div class="ui-panel">
            <div class="panel-header">
              <span class="panel-title">Lucro/Preju√≠zo Di√°rio (PnL)</span>
            </div>
            <div class="panel-body">
              <div class="chart-container-sm"><canvas id="dailyChart"></canvas></div>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="ui-panel">
            <div class="panel-header">
              <span class="panel-title">Qualidade dos Ativos (Tier List)</span>
            </div>
            <div class="panel-body">
              <div class="chart-container-sm"><canvas id="tierChart"></canvas></div>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-3 mb-4">
        <div class="col-12 col-md-6">
          <div class="ui-panel h-100">
            <div class="panel-header">
              <span class="panel-title text-success">üöÄ Top Valoriza√ß√£o (24h)</span>
            </div>
            <div class="table-responsive flex-grow-1">
              <table class="table table-sm align-middle mb-0">
                <tbody id="tableTopGainers"></tbody>
              </table>
            </div>
          </div>
        </div>
        <div class="col-12 col-md-6">
          <div class="ui-panel h-100">
            <div class="panel-header">
              <span class="panel-title text-danger">üìâ Maiores Quedas (24h)</span>
            </div>
            <div class="table-responsive flex-grow-1">
              <table class="table table-sm align-middle mb-0">
                <tbody id="tableTopLosers"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-12">
          <div class="ui-panel h-100">
            <div class="panel-header">
              <span class="panel-title">Top 10 Assets (Valor Total)</span>
            </div>
            <div class="table-responsive flex-grow-1">
              <table class="table table-hover align-middle">
                <thead>
                  <tr>
                    <th style="width: 40px" class="ps-4">#</th>
                    <th>Carta</th>
                    <th class="text-center d-none d-md-table-cell">Set</th>
                    <th class="text-end pe-4">Total</th>
                  </tr>
                </thead>
                <tbody id="tableTopAssets"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const BRL = new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' })
      Chart.defaults.font.family = "'Inter', sans-serif"
      Chart.defaults.color = '#64748b'
      Chart.defaults.borderColor = '#2a2b32'

      let currentSearchResults = []

      async function performSearch(e) {
        e.preventDefault()
        const query = document.getElementById('searchInput').value.trim()
        if (query.length < 2) return

        const modalEl = document.getElementById('searchModal')
        const modal = new bootstrap.Modal(modalEl)
        modal.show()
        const tbody = document.getElementById('searchResultsBody')
        tbody.innerHTML =
          '<tr><td colspan="5" class="text-center py-4 text-muted">Buscando...</td></tr>'
        document.getElementById('noResults').classList.add('d-none')

        try {
          const req = await fetch(`/api/search?q=${encodeURIComponent(query)}`)
          currentSearchResults = await req.json()
          tbody.innerHTML = ''

          if (currentSearchResults.length === 0) {
            document.getElementById('noResults').classList.remove('d-none')
          } else {
            document.getElementById('noResults').classList.add('d-none')
            currentSearchResults.forEach((c, index) => {
              const tr = document.createElement('tr')
              let iconHistory = '<i class="bi bi-clock-history"></i>'
              if (c.history && c.history.length > 1) {
                const current = c.history[0].value
                const previous = c.history[1].value
                if (current > previous)
                  iconHistory = '<i class="bi bi-graph-up-arrow text-success"></i>'
                else if (current < previous)
                  iconHistory = '<i class="bi bi-graph-down-arrow text-danger"></i>'
              }
              const extraBadge = c.extras ? `<span class="badge-extra ms-2">${c.extras}</span>` : ''

              tr.innerHTML = `
                <td class="ps-4"><div class="d-flex align-items-center"><div class="col-card-name">${
                  c.name
                }</div><div class="d-none d-md-block">${extraBadge}</div></div><div class="d-block d-sm-none mt-1"><span class="badge-tech">${
                c.set
              }</span> ${extraBadge}</div></td>
                <td class="text-center d-none d-sm-table-cell"><span class="badge-tech">${
                  c.set
                }</span></td>
                <td class="text-center"><button class="btn-history" onclick="openHistory(${index})">${iconHistory} <span class="d-none d-sm-inline ms-1" style="font-size: 0.75rem;">Ver</span></button></td>
                <td class="text-center text-muted">${c.qty}</td>
                <td class="text-end fw-bold text-white pe-4">${BRL.format(c.totalPrice)}</td>
              `
              tbody.appendChild(tr)
            })
          }
          document.getElementById('searchModalTitle').innerText = `Resultados: "${query}"`
        } catch (error) {
          console.error(error)
          tbody.innerHTML =
            '<tr><td colspan="5" class="text-center text-danger py-4">Erro.</td></tr>'
        }
      }

      function openHistory(index) {
        const card = currentSearchResults[index]
        if (!card) return
        const historyModal = new bootstrap.Modal(document.getElementById('historyDetailModal'))
        historyModal.show()
        document.getElementById('histTitle').innerText = `${card.name} (${card.set})`
        const tbody = document.getElementById('historyTableBody')
        tbody.innerHTML = ''
        if (!card.history || card.history.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="2" class="text-center text-muted">Sem dados.</td></tr>'
          return
        }
        card.history.forEach((h, i) => {
          const tr = document.createElement('tr')
          let diffIcon = ''
          if (i < card.history.length - 1) {
            const prevVal = card.history[i + 1].value
            if (h.value > prevVal) diffIcon = '<span class="text-success small ms-1">‚ñ≤</span>'
            else if (h.value < prevVal) diffIcon = '<span class="text-danger small ms-1">‚ñº</span>'
          }
          const dp = h.date.split('-')
          tr.innerHTML = `<td class="ps-3 text-muted">${dp[2]}/${
            dp[1]
          }</td><td class="text-end pe-3 text-white fw-bold">${BRL.format(
            h.value
          )} ${diffIcon}</td>`
          tbody.appendChild(tr)
        })
      }

      async function initDashboard() {
        try {
          const req = await fetch('/api/dashboard')
          const data = await req.json()

          if (!data || data.empty) {
            document.getElementById('kpiTotal').innerText = 'R$ 0,00'
            return
          }

          document.getElementById('kpiTotal').innerText = BRL.format(data.kpis.totalValue || 0)
          document.getElementById('kpiQty').innerText = data.kpis.totalCards || 0
          document.getElementById('kpiTicket').innerText = BRL.format(data.kpis.avgTicket || 0)

          if (data.kpis.lastUpdate) {
            const dp = data.kpis.lastUpdate.split('-')
            document.getElementById('lastUpdate').innerText = `${dp[2]}/${dp[1]}`
          }

          const varVal = data.kpis.dayVar || 0
          const varEl = document.getElementById('kpiVar')
          varEl.innerText = (varVal > 0 ? '+' : '') + BRL.format(varVal)
          varEl.className = 'big-number mt-2 ' + (varVal >= 0 ? 'var-up' : 'var-down')

          const varMonth = data.kpis.monthVar || 0
          const monthEl = document.getElementById('kpiMonth')
          monthEl.innerText = (varMonth > 0 ? '+' : '') + BRL.format(varMonth)
          monthEl.className = 'big-number mt-2 ' + (varMonth >= 0 ? 'var-up' : 'var-down')

          const ctxMain = document.getElementById('mainChart').getContext('2d')
          const gradientMain = ctxMain.createLinearGradient(0, 0, 0, 300)
          gradientMain.addColorStop(0, 'rgba(99, 102, 241, 0.3)')
          gradientMain.addColorStop(1, 'rgba(99, 102, 241, 0)')
          new Chart(ctxMain, {
            type: 'line',
            data: {
              labels: data.chart?.labels || [],
              datasets: [
                {
                  label: 'Total',
                  data: data.chart?.values || [],
                  borderColor: '#6366f1',
                  borderWidth: 2,
                  backgroundColor: gradientMain,
                  fill: true,
                  tension: 0.3,
                  pointRadius: 0,
                  pointHitRadius: 20,
                  pointHoverRadius: 6,
                  pointHoverBackgroundColor: '#fff',
                  pointHoverBorderColor: '#6366f1',
                },
              ],
            },
            options: {
              responsive: true,
              maintainAspectRatio: false,
              plugins: {
                legend: { display: false },
                tooltip: {
                  backgroundColor: 'rgba(30, 30, 36, 0.9)',
                  titleColor: '#e2e8f0',
                  bodyColor: '#fff',
                  borderColor: 'rgba(99, 102, 241, 0.2)',
                  borderWidth: 1,
                  padding: 12,
                  displayColors: false,
                  callbacks: {
                    title: function (context) {
                      const dateParts = context[0].label.split('-')
                      const dateObj = new Date(dateParts[0], dateParts[1] - 1, dateParts[2])
                      return dateObj.toLocaleDateString('pt-BR', { day: 'numeric', month: 'long' })
                    },
                    label: function (context) {
                      return BRL.format(context.parsed.y)
                    },
                  },
                },
              },
              scales: {
                x: {
                  display: true,
                  grid: { display: false, drawBorder: false },
                  ticks: {
                    color: '#64748b',
                    maxTicksLimit: 7,
                    maxRotation: 0,
                    callback: function (val) {
                      const label = this.getLabelForValue(val)
                      const parts = label.split('-')
                      return `${parts[2]}/${parts[1]}`
                    },
                  },
                },
                y: {
                  display: true,
                  position: 'right',
                  grid: { color: '#2a2b32', borderDash: [5, 5], drawBorder: false },
                  ticks: {
                    color: '#64748b',
                    maxTicksLimit: 6,
                    padding: 10,
                    callback: function (value) {
                      return new Intl.NumberFormat('pt-BR', {
                        notation: 'compact',
                        style: 'currency',
                        currency: 'BRL',
                      }).format(value)
                    },
                  },
                },
              },
            },
          })

          if (data.dailyChart && data.dailyChart.labels && data.dailyChart.labels.length > 0) {
            const ctxDaily = document.getElementById('dailyChart').getContext('2d')
            new Chart(ctxDaily, {
              type: 'bar',
              data: {
                labels: data.dailyChart.labels,
                datasets: [
                  {
                    label: 'Varia√ß√£o',
                    data: data.dailyChart.values,
                    backgroundColor: data.dailyChart.values.map(v =>
                      v >= 0 ? '#34d399' : '#f87171'
                    ),
                    borderRadius: 4,
                  },
                ],
              },
              options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { display: false }, y: { grid: { color: '#2a2b32' } } },
              },
            })
          }

          if (data.tiers && data.tiers.bulk) {
            const tiers = data.tiers
            const ctxTier = document.getElementById('tierChart').getContext('2d')
            new Chart(ctxTier, {
              type: 'bar',
              data: {
                labels: [tiers.bulk.label, tiers.low.label, tiers.mid.label, tiers.high.label],
                datasets: [
                  {
                    label: 'Qtd Cartas',
                    data: [tiers.bulk.qty, tiers.low.qty, tiers.mid.qty, tiers.high.qty],
                    backgroundColor: ['#475569', '#94a3b8', '#6366f1', '#a855f7'],
                    borderRadius: 4,
                  },
                ],
              },
              options: {
                indexAxis: 'y',
                responsive: true,
                maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { display: false }, y: { grid: { display: false } } },
              },
            })
          }

          const tbodyGain = document.getElementById('tableTopGainers')
          if (!data.topGainers || data.topGainers.length === 0) {
            tbodyGain.innerHTML =
              '<tr><td class="text-center text-muted small">Sem dados.</td></tr>'
          } else {
            data.topGainers.forEach(c => {
              const tr = document.createElement('tr')
              tr.innerHTML = `<td class="ps-3"><div class="col-card-name" style="max-width: 140px;">${
                c.name
              }</div></td><td class="text-end pe-3 var-up small">+${BRL.format(c.diff)}</td>`
              tbodyGain.appendChild(tr)
            })
          }

          const tbodyLoss = document.getElementById('tableTopLosers')
          if (!data.topLosers || data.topLosers.length === 0) {
            tbodyLoss.innerHTML =
              '<tr><td class="text-center text-muted small">Sem quedas relevantes.</td></tr>'
          } else {
            data.topLosers.forEach(c => {
              const tr = document.createElement('tr')
              tr.innerHTML = `<td class="ps-3"><div class="col-card-name" style="max-width: 140px;">${
                c.name
              }</div></td><td class="text-end pe-3 var-down small">${BRL.format(c.diff)}</td>`
              tbodyLoss.appendChild(tr)
            })
          }

          const tbodyTop = document.getElementById('tableTopAssets')
          if (data.topAssets) {
            data.topAssets.forEach((c, i) => {
              const tr = document.createElement('tr')
              tr.innerHTML = `<td class="text-muted small ps-4">${
                i + 1
              }</td><td><div class="col-card-name">${
                c.name
              }</div></td><td class="text-center d-none d-md-table-cell"><span class="badge-tech">${
                c.set
              }</span></td><td class="text-end fw-bold text-white pe-4">${BRL.format(
                c.totalPrice
              )}</td>`
              tbodyTop.appendChild(tr)
            })
          }
        } catch (e) {
          console.error(e)
        }
      }

      initDashboard()
    </script>
  </body>
</html>
